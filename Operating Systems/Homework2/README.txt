Λειτουργικά Συστήματα Εργασία 2


Ιωάννης Τασσόπουλος Α.Μ.: 1115201500155


Στο πρόγραμμα αρχίκα γίνεται έλεχνος τον arguments από το command line. Το πρόγραμμα καλείται με
./main -a x -f x -q e x -t x

Το -a είναι για το αν θα χρησιμοποιήσουμε WS(working set) ή LRU. 
Το -f είναι ο αριθμός πλαισίων της κεντρικής μνήμης (frames).
Το -q είναι το q. 
Το -t είναι τα δευτερόλεπτα (secs) αν χρησιμοποιηθεί ο αλγόριθμος WS. 

Αρχικά, στο πρόγραμμα γίνεται έλεγχος των arguments (αν έχουν δoθεί όλα, και αν είναι θετικά). Έπειτα, καλείται ο αντίστοιχος αλγόριθμος. 
LRU: η συνάρτηση LRU, παίρνει ως ορίσματα τα frames και το q. Αρχικά, δημιουργεί έναν ανεστραμμένο πίνακα σελίδων (ipt). 
Έπειτα, δημιουργεί τις δύο λίστες που έχουν διαφορετικό pid. Μετά, ανοίγουμε τα αρχεία (bzip.trace και gcc.trace) και η μια λίστα διαβάζει το ένα, και η άλλη λίστα το άλλο.
Για κάθε σειρά, καλείται η συνάρτηση LRU της λίστας. Αυτή η συνάρτηση διαβάζει το page και βλέπει αν υπάρχει στη λίστα. 
Εαν υπάρχει στη λίστα, ανεβάζουμε τον reference counter και αλλάζουμε το r ή w, αν χρειαστεί (ανεβάζοντας και τον counter του write). 
Εαν δεν υπάρχει στη λίστα, ανεβάζουμε τον page fault counter. Μόλις βγούμε από τη συνάρτηση αυτή, πάμε τον κόμβο στην αρχή της λίστας.
Εάν δεν υπάρχει το page, ελέγχουμε αν ο ipt είναι γεμάτος ή όχι. Αν είναι γεμάτος, αλλάζουμε το page του τελευταίου κόμβου της λίστας στο ipt με τον νέο κόμβο, 
και βγάζουμε τον τελευταίο κόμβο της λίστας και εισάγουμε το νέο κόμβο στην αρχή της λίστας.
Αν δεν είναι γεμάτος, απλώς εισάγουμε το νέο page και στον ipt, και στην αρχή της λίστας. 

WS: η συνάρτηση αυτή παίρνει ως ορίσματα τα frames, το q, και τα δευτερόλεπτα. Αρχικά, πολλαπλασιάζουμε τα δευτερόλεπτα με τα CLOCKS_PER_SEC για να πάρουμε τα clocks. 
Αντίστοιχα όπως στην LRU, δημιουργούνται οι λίστες και διαβάζονται τα αρχεία. Όταν καλείται ο αλγόριθμος WS από τη λίστα, αυτός ο αλγόριθμος αρχικά 
με τη συνάρτηση clock(); παίρνει τον χρόνο εκείνη τη στιγμή (current time). Αν αυτός ο χρόνος είναι μεγαλύτερος από το start time (όπου ο start time παίρνει και αυτός την
τιμή από το clock(); όταν αρχικοποιείται η λίστα) καλείται η συνάρτηση WsTickUpdate η οποία ελέγχει αν οι κόμβοι της λίστας έχουν reference bit. 
Αν έχουν, τους δίνει τον current time και κάνει το reference bit τους 0 (false στην δικιά μου υλοποίηση). 
Εαν δεν έχουν reference bit, και ο χρόνος του κόμβου συν τον χρόνο του tick είναι μεγαλύτερος από το current time τότε διαγράφουμε τον κόμβο και αντίστοιχα
ενημερώνουμε και τον ipt. Μετά στην WS, ελέγχουμε αν υπάρχει ήδη η σελίδα, όπου αν υπάρχει, γίνεται ότι στην LRU συν το ότι ανεβάζουμε το reference bit. 
Αν δεν υπάρχει η σελίδα στη λίστα, ελέγχουμε αν είναι γεμάτος ο ipt ή όχι. Αν είναι γεμάτος, αντίστοιχα όπως στην LRU, ενημερώνεται για το page και εισάγουμε
το νέο page στον ipt και στη λίστα με το current time. Αντίστοιχα, αν δεν είναι γεμάτος, εισάγουμε το page και στον ipt και στη λίστα, πάλι με το current time.

Στο τέλος και των δύο συναρτήσεων γίνονται τα αντίστοιχα prints και αποδεσμεύουμε τη μνήμη. 